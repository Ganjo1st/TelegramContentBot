#!/bin/bash

# start_server.sh - –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –¥–ª—è Linux —Å–µ—Ä–≤–µ—Ä–∞

echo "========================================"
echo "üöÄ –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"
echo "========================================"

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
if [ -d "venv" ]; then
    source venv/bin/activate
    echo "‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ"
fi

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
echo "üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
pip install -r requirements_server.txt --quiet

# –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫–∏ –¥–ª—è –ª–æ–≥–æ–≤ –∏ –¥–∞–Ω–Ω—ã—Ö
mkdir -p backup logs

# –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ —Å nohup (–¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ —Ñ–æ–Ω–µ)
echo "ü§ñ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ..."
nohup python server_bot.py > logs/bot_output.log 2>&1 &

# –°–æ—Ö—Ä–∞–Ω—è–µ–º PID
echo $! > bot.pid
echo "‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω —Å PID: $!"

echo ""
echo "üìã –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:"
echo "  –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å: tail -f logs/bot_output.log"
echo "  –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞: kill \$(cat bot.pid)"
echo "  –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å: ./restart_server.sh"
echo "========================================"